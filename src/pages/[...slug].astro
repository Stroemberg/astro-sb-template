---
import { useStoryblokApi, getLiveStory } from '@storyblok/astro';
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro';
import Layout from '../layouts/Layout.astro';
import generateStaticPaths from '../utils/generateStaticPaths';

export async function getStaticPaths() {
	return await generateStaticPaths();
}
const { slug } = Astro.params;

const storyblokApi = useStoryblokApi();

const { data } = await storyblokApi
	.get(`cdn/stories/${slug || 'home'}`, {
		version: 'draft',
	})
	.catch((error) => {
		return { data: { status: error.response.status } };
	});

if (data.status === 404) {
	return Astro.redirect('/404');
}

const story = data.story;
const liveStory = await getLiveStory(Astro);
---

<Layout>
	<StoryblokComponent blok={liveStory?.content || story.content} />
</Layout>
